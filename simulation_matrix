using PyPlot
using Distributions

a=(0;1)
b=(1;0)
generation = 500
repetition =10

gen_vector=zeros(repetition,1)
ev_matrix= zeros(repetition,generation)

#function for  getting -1 or 1
function r(x)
    x= rand()
    if x>0.5
      return 1
    else return -1
    end
end
#simulate genetic drift with mutation and repeat 
function simulation(N,A)
  ev_matrix[:,1] = N/2
   for rep in 1:repetition
     for gen in 2:generation

       #add mutation
       μ=0.04
       l=rand(Poisson(μ*N))
       mutate = r(l)*l
       ev_matrix[rep,gen]=ev_matrix[rep,gen-1]+mutate

       #be sure 0<p<1
       if ev_matrix[rep,gen] < 0
         ev_matrix[rep,gen:generation]=NaN
         gen_vector[rep]= gen
         break
       elseif ev_matrix[rep,gen] > N
         ev_matrix[rep,gen:generation]=NaN
         gen_vector[rep]= gen
         break
       end
       #genetic drift loop
        p= ev_matrix[rep,gen]/N
        A= rand(Binomial(N,p))

        #update state
        ev_matrix[rep,gen]=A

        #stop if extinction or fixation
        if ev_matrix[rep,gen]==0 || ev_matrix[rep,gen]==N
          ev_matrix[rep,gen:generation]=NaN
          gen_vector[rep]= gen
          break
        end
      end
    end
  end

    simulation(100,30)

for i in 1:10
plot(ev_matrix[i,:])
end
